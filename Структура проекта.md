# Руководство для разработчиков

## Структура проекта

Проект разработан на Laravel 11 и использует следующие технологии:
- **Backend**: Laravel 11, PHP 8.3
- **Database**: MySQL 8.0
- **Frontend**: Blade Templates, Tailwind CSS, Vite
- **Deployment**: Docker

## Организация файлов

### Layouts (Шаблоны)
`resources/views/layouts/app.blade.php` - основной layout со следующей структурой:
- Navigation (навигация)
- Main content (@yield('content'))
- Footer (подвал)

### Views (Представления)
- `resources/views/index.blade.php` - главная страница
- `resources/views/news/index.blade.php` - пример страницы новостей

### Models (Модели)
Все модели находятся в `app/Models/`:
- **User** - пользователи (участники, наставники, координаторы, организаторы)
- **Role** - роли в системе RBAC
- **Permission** - разрешения для ролей
- **Municipality** - муниципальные образования
- **Organization** - образовательные организации
- **Team** - команды участников
- **Event** - события (календарь)
- **News** - новости
- **Material** - материалы для подготовки
- **MunicipalStage** - муниципальные этапы
- **RegionalStage** - региональные этапы
- **Review** - отзывы
- **ConsentDocument** - согласия на ОПД

**Полная документация**: `Описание моделей.md`

## Работа с Tailwind CSS

В проекте используется Tailwind CSS для стилизации. Основные классы:

### Цветовая схема
- **Primary**: `indigo-600` (основной цвет)
- **Secondary**: `purple-600` (дополнительный)
- **Success**: `green-600`
- **Warning**: `yellow-600`
- **Danger**: `red-600`

### Примеры компонентов

#### Кнопка
```blade
<a href="#" class="px-8 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition">
    Текст кнопки
</a>
```

#### Карточка
```blade
<div class="bg-white rounded-lg shadow p-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Заголовок</h3>
    <p class="text-gray-600">Содержание карточки</p>
</div>
```

#### Alert
```blade
<div class="bg-green-50 border border-green-200 rounded-lg p-6">
    <p class="text-green-900">Успешное сообщение</p>
</div>
```

## Работа с ролями (RBAC)

### Проверка роли в Blade
```blade
@if(auth()->user()->hasRole('organizer'))
    <!-- Контент для организатора -->
@endif

@if(auth()->user()->hasAnyRole(['organizer', 'coordinator']))
    <!-- Контент для организатора или координатора -->
@endif
```

### Проверка разрешения
```blade
@if(auth()->user()->hasPermission('create_news'))
    <!-- Контент для пользователей с правом создания новостей -->
@endif
```

### В контроллерах
```php
// Проверка роли
if (auth()->user()->hasRole('organizer')) {
    // Действия для организатора
}

// Проверка разрешения
if (auth()->user()->hasPermission('edit_teams')) {
    // Действия с правом редактирования команд
}
```

## Работа с базой данных

### Получение данных
```php
// Все новости
$news = News::published()->orderBy('published_at', 'desc')->get();

// Команды определенного муниципалитета
$teams = Team::where('municipality_id', $municipalityId)
    ->with(['organization', 'mentor', 'members'])
    ->get();

// Активные пользователи с ролью участник
$participants = User::active()
    ->participants()
    ->with('team')
    ->get();

// События календаря
$events = Event::whereBetween('start_date', [$startDate, $endDate])
    ->orderBy('start_date')
    ->get();
```

### Создание записей
```php
// Создание новости
$news = News::create([
    'title' => 'Заголовок',
    'content' => 'Содержание',
    'author_id' => auth()->id(),
    'is_published' => true,
    'published_at' => now(),
]);

// Создание команды
$team = Team::create([
    'name' => 'Название команды',
    'organization_id' => $organizationId,
    'municipality_id' => $municipalityId,
    'mentor_id' => $mentorId,
    'grade' => 9,
]);
```

## Маршруты (Routes)

Файл: `routes/web.php`

```php
// Главная страница
Route::get('/', function () {
    return view('index');
});

// Группа маршрутов с аутентификацией
Route::middleware(['auth'])->group(function () {
    // Дашборд
    Route::get('/dashboard', [DashboardController::class, 'index']);
    
    // CRUD для новостей
    Route::resource('news', NewsController::class);
});

// Группа маршрутов для организаторов
Route::middleware(['auth', 'role:organizer'])->group(function () {
    Route::resource('municipalities', MunicipalityController::class);
    Route::resource('organizations', OrganizationController::class);
});
```

## Задачи для реализации

### 1. Аутентификация
- [ ] Установить Laravel Breeze: `composer require laravel/breeze --dev`
- [ ] Настроить регистрацию с выбором роли
- [ ] Добавить загрузку согласия на ОПД при регистрации
- [ ] Создать middleware для проверки ролей

### 2. CRUD функционал
- [ ] Новости (News)
- [ ] События (Events)
- [ ] Материалы (Materials)
- [ ] Муниципалитеты (Municipalities)
- [ ] Организации (Organizations)
- [ ] Команды (Teams)

### 3. Функционал этапов
- [ ] Регистрация команд на муниципальный этап
- [ ] Ввод результатов муниципального этапа
- [ ] Формирование списка команд для регионального этапа
- [ ] Ввод результатов регионального этапа
- [ ] Формирование итоговых рейтингов

### 4. Публичные страницы
- [ ] Главная страница с новостями и событиями
- [ ] Страница со списком новостей и детальная страница новости
- [ ] Календарь событий
- [ ] Список материалов для подготовки
- [ ] Рейтинги команд и участников
- [ ] Отзывы о турнире

### 5. Личный кабинет
- [ ] Dashboard для каждой роли
- [ ] Для участника: просмотр команды, результатов
- [ ] Для наставника: управление командой
- [ ] Для координатора: управление командами муниципалитета
- [ ] Для организатора: полный доступ ко всем функциям

## Пример создания контроллера

```bash
php artisan make:controller NewsController --resource
```

```php
<?php

namespace App\Http\Controllers;

use App\Models\News;
use Illuminate\Http\Request;

class NewsController extends Controller
{
    public function index()
    {
        $news = News::published()->orderBy('published_at', 'desc')->paginate(12);
        return view('news.index', compact('news'));
    }

    public function show(News $news)
    {
        return view('news.show', compact('news'));
    }

    public function create()
    {
        return view('news.create');
    }

    public function store(Request $request)
    {
        $validated = $request->validate([
            'title' => 'required|max:255',
            'content' => 'required',
        ]);

        $news = News::create([
            ...$validated,
            'author_id' => auth()->id(),
        ]);

        return redirect()->route('news.show', $news)
            ->with('success', 'Новость успешно создана');
    }
}
```

## Полезные команды

```bash
# Создать контроллер
php artisan make:controller ИмяController

# Создать модель с миграцией
php artisan make:model ИмяМодели -m

# Создать seeder
php artisan make:seeder ИмяSeeder

# Запустить миграции
php artisan migrate

# Откатить миграции
php artisan migrate:rollback

# Очистить кэш
php artisan cache:clear
php artisan config:clear
php artisan view:clear
```

## Дополнительные ресурсы

- [Laravel Documentation](https://laravel.com/docs)
- [Tailwind CSS Documentation](https://tailwindcss.com/docs)
- [Blade Templates](https://laravel.com/docs/blade)
